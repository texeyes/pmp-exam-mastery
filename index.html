<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMP Exam Prep - Evidence-Based Learning</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-light: #f3f4f6;
            --bg-dark: #1f2937;
            --text-dark: #374151;
            --text-light: #f9fafb;
            --border: #d1d5db;
            --people-color: #3b82f6;
            --process-color: #10b981;
            --business-color: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
        }

        body.dark-mode {
            background: var(--bg-dark);
            color: var(--text-light);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        body.dark-mode header {
            background: #111827;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        h1 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .nav-tabs {
            display: flex;
            gap: 5px;
            border-bottom: 2px solid var(--border);
            margin: 20px 0;
            overflow-x: auto;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            color: var(--text-dark);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }

        body.dark-mode .nav-tab {
            color: var(--text-light);
        }

        .nav-tab:hover {
            background: rgba(37, 99, 235, 0.1);
        }

        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        body.dark-mode .card {
            background: #1f2937;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-secondary {
            background: var(--border);
            color: var(--text-dark);
        }

        .progress-bar-container {
            background: #e5e7eb;
            border-radius: 10px;
            height: 24px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), #3b82f6);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .domain-section {
            margin: 20px 0;
        }

        .domain-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-light);
            border-radius: 6px;
            margin-bottom: 10px;
        }

        body.dark-mode .domain-header {
            background: #111827;
        }

        .question-card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        body.dark-mode .question-card {
            background: #1f2937;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .question-text {
            font-size: 1.1rem;
            line-height: 1.8;
            margin: 20px 0;
        }

        .options {
            margin: 20px 0;
        }

        .option {
            padding: 15px;
            margin: 10px 0;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .option.selected {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.1);
        }

        .option.correct {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .option.incorrect {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .explanation {
            background: #f0f9ff;
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        body.dark-mode .explanation {
            background: rgba(37, 99, 235, 0.1);
        }

        .topic-card {
            border: 1px solid var(--border);
            border-radius: 6px;
            margin: 10px 0;
            overflow: hidden;
        }

        .topic-header {
            padding: 15px;
            background: var(--bg-light);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark-mode .topic-header {
            background: #111827;
        }

        .topic-content {
            padding: 15px;
            display: none;
        }

        .topic-content.expanded {
            display: block;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .badge-people {
            background: rgba(59, 130, 246, 0.2);
            color: var(--people-color);
        }

        .badge-process {
            background: rgba(16, 185, 129, 0.2);
            color: var(--process-color);
        }

        .badge-business {
            background: rgba(245, 158, 11, 0.2);
            color: var(--business-color);
        }

        .badge-easy { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .badge-medium { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .badge-hard { background: rgba(239, 68, 68, 0.2); color: var(--danger); }

        .confidence-buttons {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .filter-section {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            align-items: center;
        }

        select, input {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.95rem;
            background: white;
            color: var(--text-dark);
        }

        body.dark-mode select,
        body.dark-mode input {
            background: #111827;
            color: var(--text-light);
            border-color: #374151;
        }

        .chart-container {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }

        body.dark-mode .chart-container {
            background: #1f2937;
        }

        canvas {
            max-width: 100%;
        }

        .review-item {
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .learning-guide-section {
            margin: 30px 0;
        }

        .learning-guide-section h3 {
            color: var(--primary);
            margin: 20px 0 10px 0;
        }

        .welcome-hero {
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-hero h2 {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .streak-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            color: white;
            border-radius: 20px;
            font-weight: 600;
        }

        .milestone-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
            display: none;
        }

        body.dark-mode .milestone-popup {
            background: #1f2937;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 1.2rem;
            }

            .nav-tab {
                padding: 10px 12px;
                font-size: 0.85rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="overlay" id="overlay"></div>
    <div class="milestone-popup" id="milestonePopup">
        <h2 id="milestoneTitle">üéâ Congratulations!</h2>
        <p id="milestoneMessage"></p>
        <button class="btn btn-primary" onclick="closeMilestone()">Continue Learning</button>
    </div>

    <header>
        <div class="header-content">
            <div>
                <h1>PMP Exam Prep</h1>
                <p style="font-size: 0.85rem; opacity: 0.8;">Evidence-Based Learning System</p>
            </div>
            <div class="header-actions">
                <span class="streak-indicator" id="streakDisplay">üî• 0 day streak</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </header>

    <div class="container">
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="switchTab('study')">Study Material</button>
            <button class="nav-tab" onclick="switchTab('practice')">Practice Questions</button>
            <button class="nav-tab" onclick="switchTab('review')">
                Spaced Review <span class="badge" style="background: var(--danger); color: white; margin-left: 5px;" id="reviewBadge">0</span>
            </button>
            <button class="nav-tab" onclick="switchTab('analytics')">Performance Analytics</button>
            <button class="nav-tab" onclick="switchTab('learning')">Learning Guide</button>
            <button class="nav-tab" onclick="switchTab('settings')">Settings</button>
        </nav>

        <div id="dashboard" class="tab-content active">
            <div class="welcome-hero card">
                <h2>Welcome to PMP Exam Prep</h2>
                <p>Master the PMP exam using proven, science-backed learning techniques</p>
            </div>

            <div class="card">
                <h3>Your Progress Overview</h3>
                <p style="margin: 10px 0;">Track your mastery across all three PMP exam domains</p>

                <div class="domain-section">
                    <div class="domain-header">
                        <span><strong>People Domain</strong> (42% of exam)</span>
                        <span class="badge badge-people" id="peopleScore">0%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="peopleProgress" style="width: 0%; background: var(--people-color);">0%</div>
                    </div>
                </div>

                <div class="domain-section">
                    <div class="domain-header">
                        <span><strong>Process Domain</strong> (50% of exam)</span>
                        <span class="badge badge-process" id="processScore">0%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="processProgress" style="width: 0%; background: var(--process-color);">0%</div>
                    </div>
                </div>

                <div class="domain-section">
                    <div class="domain-header">
                        <span><strong>Business Environment Domain</strong> (8% of exam)</span>
                        <span class="badge badge-business" id="businessScore">0%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="businessProgress" style="width: 0%; background: var(--business-color);">0%</div>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card" style="background: linear-gradient(135deg, var(--primary), #3b82f6);">
                    <div class="stat-value" id="totalAttempted">0</div>
                    <div class="stat-label">Questions Attempted</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--success), #059669);">
                    <div class="stat-value" id="accuracyRate">0%</div>
                    <div class="stat-label">Accuracy Rate</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--warning), #d97706);">
                    <div class="stat-value" id="reviewDue">0</div>
                    <div class="stat-label">Reviews Due Today</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="switchTab('study')">üìö Start Studying</button>
                <button class="btn btn-success" onclick="switchTab('practice')">‚úèÔ∏è Practice Questions</button>
                <button class="btn" style="background: var(--warning); color: white;" onclick="switchTab('review')">üîÑ Review Due Items</button>
            </div>
        </div>

        <div id="study" class="tab-content">
            <div class="card">
                <h2>Study Material</h2>
                <p>Explore PMP concepts organized by domain. Click to expand each topic.</p>
            </div>

            <div class="filter-section">
                <label>
                    <strong>Select Domain:</strong>
                    <select id="studyDomainFilter" onchange="filterStudyMaterial()">
                        <option value="all">All Domains</option>
                        <option value="People">People</option>
                        <option value="Process">Process</option>
                        <option value="Business Environment">Business Environment</option>
                    </select>
                </label>
            </div>

            <div id="studyContent"></div>
        </div>

        <div id="practice" class="tab-content">
            <div class="card">
                <h2>Practice Questions</h2>
                <p>Test your knowledge with interleaved practice questions</p>
            </div>

            <div class="filter-section">
                <label>
                    <strong>Questions per session:</strong>
                    <select id="questionsPerSession">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="30">30</option>
                        <option value="50">50</option>
                    </select>
                </label>
                <label>
                    <strong>Domain:</strong>
                    <select id="practiceDomain">
                        <option value="all">All Domains</option>
                        <option value="People">People</option>
                        <option value="Process">Process</option>
                        <option value="Business Environment">Business Environment</option>
                    </select>
                </label>
                <label>
                    <strong>Difficulty:</strong>
                    <select id="practiceDifficulty">
                        <option value="all">All Levels</option>
                        <option value="Easy">Easy</option>
                        <option value="Medium">Medium</option>
                        <option value="Hard">Hard</option>
                    </select>
                </label>
                <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="timerToggle">
                    <span>Enable Timer</span>
                </label>
                <button class="btn btn-primary" onclick="startPracticeSession()">Start Session</button>
            </div>

            <div id="practiceSession" style="display: none;">
                <div class="question-card" id="questionCard">
                    <div class="question-header">
                        <span id="questionProgress">Question 1 of 20</span>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <span id="timerDisplay" style="display: none; font-weight: 600;">‚è±Ô∏è 0:00</span>
                            <span class="badge" id="questionDomain">People</span>
                            <span class="badge" id="questionDifficulty">Medium</span>
                        </div>
                    </div>
                    <div class="question-text" id="questionText"></div>
                    <div class="options" id="questionOptions"></div>
                    <div id="feedbackSection" style="display: none;">
                        <div class="explanation" id="explanation"></div>
                        <div class="confidence-buttons">
                            <p><strong>How confident are you with this answer?</strong></p>
                            <button class="btn btn-success" onclick="rateConfidence('high')">High Confidence</button>
                            <button class="btn" style="background: var(--warning); color: white;" onclick="rateConfidence('medium')">Medium</button>
                            <button class="btn btn-danger" onclick="rateConfidence('low')">Low - Need Review</button>
                        </div>
                        <div style="margin-top: 20px;">
                            <label><strong>Why does this make sense? (Elaborative Interrogation)</strong></label>
                            <textarea id="elaborationNotes" style="width: 100%; min-height: 80px; margin-top: 10px; padding: 10px; border-radius: 6px; border: 1px solid var(--border);"></textarea>
                        </div>
                    </div>
                    <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: space-between;">
                        <button class="btn btn-secondary" onclick="skipQuestion()" id="skipBtn">Skip</button>
                        <button class="btn btn-primary" onclick="submitAnswer()" id="submitBtn">Submit Answer</button>
                        <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn" style="display: none;">Next Question</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="review" class="tab-content">
            <div class="card">
                <h2>Spaced Repetition Review</h2>
                <p>Review questions based on the forgetting curve to maximize retention</p>
                <div id="reviewStats" style="margin: 20px 0;"></div>
            </div>

            <div class="filter-section">
                <button class="btn btn-primary" onclick="startReviewSession()">Start Review Session</button>
                <button class="btn btn-secondary" onclick="showReviewSchedule()">View Schedule</button>
            </div>

            <div id="reviewContent"></div>
        </div>

        <div id="analytics" class="tab-content">
            <div class="card">
                <h2>Performance Analytics</h2>
                <p>Visualize your progress and identify areas for improvement</p>
            </div>

            <div class="chart-container">
                <h3>Domain Performance</h3>
                <canvas id="domainChart" width="400" height="250"></canvas>
            </div>

            <div class="chart-container">
                <h3>Accuracy Trend Over Time</h3>
                <canvas id="trendChart" width="400" height="200"></canvas>
            </div>

            <div class="card">
                <h3>Detailed Breakdown</h3>
                <div id="detailedStats"></div>
            </div>
        </div>

        <div id="learning" class="tab-content">
            <div class="card">
                <h2>Learning Guide: The Science Behind This App</h2>
                <p>Understanding how you learn will help you study more effectively</p>
            </div>

            <div class="card learning-guide-section">
                <h3>üß† Evidence-Based Learning Techniques</h3>
                <p>This application incorporates five proven learning strategies backed by cognitive science research:</p>

                <h4 style="margin-top: 25px;">1. Spaced Repetition</h4>
                <p><strong>What it is:</strong> Reviewing material at increasing intervals to combat the forgetting curve.</p>
                <p><strong>How we use it:</strong> Questions are scheduled for review based on your performance:</p>
                <ul style="margin: 10px 0 10px 30px;">
                    <li>Incorrect answer ‚Üí Review in 1 day</li>
                    <li>Correct but need review ‚Üí Review in 3 days</li>
                    <li>Correct and confident ‚Üí Review in 7 days</li>
                    <li>Mastered (3+ correct) ‚Üí Review in 14 days</li>
                </ul>
                <p><strong>Research:</strong> Studies show spaced repetition improves long-term retention by 200-300% compared to massed practice (Cepeda et al., 2006).</p>

                <h4 style="margin-top: 25px;">2. Active Recall</h4>
                <p><strong>What it is:</strong> Retrieving information from memory rather than passive review.</p>
                <p><strong>How we use it:</strong> You must answer questions before seeing explanations. No peeking allowed!</p>
                <p><strong>Research:</strong> The testing effect shows retrieval practice enhances retention more than re-reading (Roediger &amp; Karpicke, 2006).</p>

                <h4 style="margin-top: 25px;">3. Interleaving Practice</h4>
                <p><strong>What it is:</strong> Mixing different topics and question types during study sessions.</p>
                <p><strong>How we use it:</strong> Questions from different domains are shuffled together, forcing you to discriminate between concepts.</p>
                <p><strong>Research:</strong> Interleaved practice improves discrimination and problem-solving by 50% (Rohrer, 2012).</p>

                <h4 style="margin-top: 25px;">4. Immediate Feedback</h4>
                <p><strong>What it is:</strong> Receiving instant explanations after answering questions.</p>
                <p><strong>How we use it:</strong> After each answer, you immediately see detailed explanations of both correct and incorrect options.</p>
                <p><strong>Research:</strong> Immediate feedback prevents reinforcement of errors and enhances learning (Attali &amp; Powers, 2009).</p>

                <h4 style="margin-top: 25px;">5. Elaborative Interrogation</h4>
                <p><strong>What it is:</strong> Asking 'why' and 'how' questions to connect new information to prior knowledge.</p>
                <p><strong>How we use it:</strong> After each explanation, you're prompted to explain the concept in your own words.</p>
                <p><strong>Research:</strong> Elaboration strengthens memory by creating more retrieval cues (Dunlosky et al., 2013).</p>
            </div>

            <div class="card learning-guide-section">
                <h3>üìÖ Recommended Study Schedule</h3>
                <ul style="margin: 10px 0 10px 30px; line-height: 2;">
                    <li><strong>Daily Practice:</strong> 20-30 questions per day</li>
                    <li><strong>Study Duration:</strong> 45-60 minutes per session</li>
                    <li><strong>Breaks:</strong> Take a 10-minute break every 45 minutes</li>
                    <li><strong>Review Time:</strong> Always complete your due reviews first</li>
                    <li><strong>Consistency:</strong> Study at the same time each day to build habit</li>
                </ul>
            </div>

            <div class="card learning-guide-section">
                <h3>üí° Tips for Maximum Effectiveness</h3>
                <ul style="margin: 10px 0 10px 30px; line-height: 2;">
                    <li>Focus on understanding concepts, not memorizing answers</li>
                    <li>Always read explanations, even when you answer correctly</li>
                    <li>Use the elaboration feature to write explanations in your own words</li>
                    <li>Be honest with confidence ratings - they guide your review schedule</li>
                    <li>Don't skip reviews - they're scheduled at optimal intervals</li>
                    <li>Mix domains to improve your ability to recognize different question types</li>
                </ul>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="card">
                <h2>Settings &amp; Preferences</h2>
            </div>

            <div class="card">
                <h3>Study Preferences</h3>
                <div style="display: flex; flex-direction: column; gap: 20px; margin-top: 20px;">
                    <label style="display: flex; justify-content: space-between; align-items: center;">
                        <span><strong>Sound Effects</strong></span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="soundToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </label>
                    <label style="display: flex; justify-content: space-between; align-items: center;">
                        <span><strong>Dark Mode</strong></span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="darkModeToggle2" onchange="toggleDarkMode()">
                            <span class="slider"></span>
                        </label>
                    </label>
                </div>
            </div>

            <div class="card">
                <h3>Data Management</h3>
                <p style="margin: 15px 0;">Your progress is automatically saved to your browser's local storage.</p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="exportData()">üì• Export Progress</button>
                    <button class="btn btn-secondary" onclick="importData()">üì§ Import Progress</button>
                    <button class="btn btn-danger" onclick="confirmReset()">üóëÔ∏è Reset All Progress</button>
                </div>
            </div>

            <div class="card">
                <h3>About PMP Exam</h3>
                <ul style="margin: 10px 0 10px 30px; line-height: 2;">
                    <li><strong>Total Questions:</strong> 180</li>
                    <li><strong>Duration:</strong> 230 minutes (3 hours 50 minutes)</li>
                    <li><strong>Passing Score:</strong> Above Target performance in all domains</li>
                    <li><strong>Methodology Split:</strong> 50% Predictive, 50% Agile/Hybrid</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Question Bank
const questionBank = [
    // PEOPLE DOMAIN (42 questions)
    {
        id: "P001",
        domain: "People",
        topic: "Leadership",
        difficulty: "Medium",
        question: "A project manager notices that two team members have opposing views on how to implement a critical feature. The conflict is affecting team morale. What should the project manager do FIRST?",
        options: [
            "A) Immediately decide which approach to use and inform the team",
            "B) Schedule a meeting with both team members to understand their perspectives",
            "C) Escalate the issue to senior management",
            "D) Remove one team member from the project"
        ],
        correct: 1,
        explanation: "The best first step is to understand both perspectives through direct communication. This demonstrates servant leadership and allows for collaborative problem-solving. The project manager should facilitate discussion before making decisions.",
        wrongExplanations: {
            0: "Making an immediate decision without understanding both perspectives misses an opportunity for team engagement and may lead to resentment.",
            2: "Escalation should only occur after attempting to resolve at the team level.",
            3: "Removing a team member is extreme and should be a last resort after other conflict resolution approaches."
        }
    },
    {
        id: "P002",
        domain: "People",
        topic: "Team Development",
        difficulty: "Easy",
        question: "According to Tuckman's model, in which stage does the team start to work together effectively and productively?",
        options: [
            "A) Forming",
            "B) Storming",
            "C) Norming",
            "D) Performing"
        ],
        correct: 3,
        explanation: "The Performing stage is when the team works cohesively and effectively toward project goals. Team members are interdependent and work through issues smoothly.",
        wrongExplanations: {
            0: "Forming is the initial stage where team members are just getting to know each other.",
            1: "Storming is characterized by conflicts as team members assert their opinions.",
            2: "Norming is when the team establishes working agreements and processes, but hasn't reached peak performance."
        }
    },
    {
        id: "P003",
        domain: "People",
        topic: "Communication",
        difficulty: "Hard",
        question: "A distributed team across three time zones is experiencing communication challenges. Some team members feel excluded from important decisions. What communication strategy would be MOST effective?",
        options: [
            "A) Schedule all meetings during business hours of the project manager's location",
            "B) Implement a communication plan with asynchronous updates and rotating meeting times",
            "C) Require all team members to work the same hours",
            "D) Communicate only through email to ensure everyone receives the same information"
        ],
        correct: 1,
        explanation: "A comprehensive communication plan with both asynchronous communication (for documentation) and rotating meeting times (to share the inconvenience) ensures inclusivity and equitable participation across time zones.",
        wrongExplanations: {
            0: "Scheduling meetings only during one location's business hours consistently disadvantages team members in other time zones.",
            2: "Requiring uniform working hours is impractical and disrespectful of global team dynamics.",
            3: "Email-only communication lacks the richness of real-time collaboration and can lead to misunderstandings."
        }
    },
    {
        id: "P004",
        domain: "People",
        topic: "Stakeholder Engagement",
        difficulty: "Medium",
        question: "A key stakeholder has high power but low interest in the project. According to the power/interest grid, how should the project manager manage this stakeholder?",
        options: [
            "A) Manage Closely",
            "B) Keep Satisfied",
            "C) Monitor",
            "D) Keep Informed"
        ],
        correct: 1,
        explanation: "Stakeholders with high power but low interest should be kept satisfied. They have the authority to impact the project but aren't actively engaged, so periodic updates to maintain their satisfaction are appropriate.",
        wrongExplanations: {
            0: "Manage Closely is for high power AND high interest stakeholders.",
            2: "Monitor is for low power and low interest stakeholders.",
            3: "Keep Informed is for high interest but low power stakeholders."
        }
    },
    {
        id: "P005",
        domain: "People",
        topic: "Motivation",
        difficulty: "Medium",
        question: "According to Herzberg's Two-Factor Theory, which of the following is a motivator (not just a hygiene factor)?",
        options: [
            "A) Adequate salary",
            "B) Good working conditions",
            "C) Recognition for achievements",
            "D) Job security"
        ],
        correct: 2,
        explanation: "Recognition for achievements is a true motivator that increases job satisfaction. Motivators relate to the job content itself and include achievement, recognition, responsibility, and growth.",
        wrongExplanations: {
            0: "Salary is a hygiene factor. Its absence causes dissatisfaction, but its presence doesn't necessarily motivate.",
            1: "Working conditions are hygiene factors that prevent dissatisfaction but don't actively motivate.",
            3: "Job security is a hygiene factor that addresses basic needs but doesn't drive motivation."
        }
    },
    {
        id: "P006",
        domain: "People",
        topic: "Conflict Resolution",
        difficulty: "Hard",
        question: "Two team members are in conflict over resource allocation. The project manager suggests they each give up something to reach an agreement quickly. Which conflict resolution technique is being used?",
        options: [
            "A) Collaborate/Problem Solve",
            "B) Compromise/Reconcile",
            "C) Smooth/Accommodate",
            "D) Force/Direct"
        ],
        correct: 1,
        explanation: "Compromise/Reconcile involves each party giving up something to reach a mutually acceptable solution. It's a lose-lose approach where no one gets everything they want, but it can be useful for quick resolution.",
        wrongExplanations: {
            0: "Collaborate/Problem Solve seeks a win-win solution where both parties' needs are fully met, not partial concessions.",
            2: "Smooth/Accommodate emphasizes areas of agreement and downplays differences.",
            3: "Force/Direct involves pushing one viewpoint at the expense of others."
        }
    },
    {
        id: "P007",
        domain: "People",
        topic: "Virtual Teams",
        difficulty: "Easy",
        question: "What is the MOST important factor for successfully managing a virtual team?",
        options: [
            "A) Using the latest collaboration technology",
            "B) Establishing clear communication protocols and expectations",
            "C) Requiring daily status reports from all team members",
            "D) Minimizing face-to-face meetings to save costs"
        ],
        correct: 1,
        explanation: "Clear communication protocols and expectations are fundamental for virtual team success. This includes when and how to communicate, response time expectations, and meeting norms.",
        wrongExplanations: {
            0: "While technology is important, it's a tool that supports communication, not the foundation of virtual team success.",
            2: "Daily reports can create unnecessary overhead; communication frequency should match project needs.",
            3: "Face-to-face meetings (even virtual) are valuable for building relationships and should not be minimized solely for cost savings."
        }
    },
    {
        id: "P008",
        domain: "People",
        topic: "Servant Leadership",
        difficulty: "Medium",
        question: "A servant leader project manager would MOST likely focus on:",
        options: [
            "A) Maintaining strict authority over team decisions",
            "B) Removing impediments and supporting team growth",
            "C) Ensuring team members follow detailed instructions",
            "D) Taking credit for team successes"
        ],
        correct: 1,
        explanation: "Servant leadership prioritizes serving the team by removing obstacles, providing resources, and facilitating growth. The leader's role is to enable the team's success.",
        wrongExplanations: {
            0: "Servant leaders empower teams rather than maintaining strict control.",
            2: "Servant leaders encourage autonomy and self-organization rather than micromanagement.",
            3: "Servant leaders share credit with the team and celebrate collective achievements."
        }
    },
    {
        id: "P009",
        domain: "People",
        topic: "Emotional Intelligence",
        difficulty: "Hard",
        question: "During a tense stakeholder meeting, a project manager notices a key stakeholder becoming defensive and withdrawn. Demonstrating emotional intelligence, what should the project manager do?",
        options: [
            "A) Continue with the agenda as planned",
            "B) Acknowledge the stakeholder's concerns and suggest a brief break",
            "C) Ask the stakeholder directly why they are being difficult",
            "D) Postpone the meeting indefinitely"
        ],
        correct: 1,
        explanation: "Emotional intelligence involves recognizing emotions in others and responding appropriately. Acknowledging concerns and providing space (break) allows for emotional regulation and more productive dialogue.",
        wrongExplanations: {
            0: "Ignoring emotional cues can escalate tension and reduce meeting effectiveness.",
            2: "Confronting someone defensively is likely to increase defensiveness rather than resolve it.",
            3: "Indefinite postponement avoids the issue rather than addressing it constructively."
        }
    },
    {
        id: "P010",
        domain: "People",
        topic: "Team Building",
        difficulty: "Easy",
        question: "What is the primary purpose of team-building activities?",
        options: [
            "A) To waste time and budget",
            "B) To improve team cohesion and collaboration",
            "C) To identify poor performers",
            "D) To fulfill HR requirements"
        ],
        correct: 1,
        explanation: "Team-building activities are designed to improve relationships, trust, and collaboration among team members, leading to better project performance.",
        wrongExplanations: {
            0: "Effective team building is a valuable investment in team performance, not a waste.",
            2: "Team building focuses on improving collaboration, not identifying weaknesses.",
            3: "While organizations may encourage team building, its primary value is enhancing team dynamics."
        }
    },
    {
        id: "P011",
        domain: "People",
        topic: "Leadership Styles",
        difficulty: "Medium",
        question: "In an Agile project, which leadership style is MOST appropriate for a project manager?",
        options: [
            "A) Autocratic",
            "B) Laissez-faire",
            "C) Servant leadership",
            "D) Transactional"
        ],
        correct: 2,
        explanation: "Servant leadership aligns best with Agile principles, focusing on empowering the team, removing impediments, and facilitating self-organization.",
        wrongExplanations: {
            0: "Autocratic leadership contradicts Agile values of team empowerment and collaboration.",
            1: "Laissez-faire provides too little guidance and support for effective Agile implementation.",
            3: "Transactional leadership's focus on rewards and penalties doesn't align with Agile's emphasis on intrinsic motivation."
        }
    },
    {
        id: "P012",
        domain: "People",
        topic: "Cultural Awareness",
        difficulty: "Hard",
        question: "A project manager is leading a global team with members from high-context and low-context cultures. What communication approach should they adopt?",
        options: [
            "A) Use only written communication to avoid misunderstandings",
            "B) Adapt communication style to audience, being explicit with low-context and building relationships with high-context cultures",
            "C) Require all team members to adapt to the project manager's cultural norms",
            "D) Avoid discussing cultural differences to prevent conflict"
        ],
        correct: 1,
        explanation: "Effective cross-cultural communication requires adapting to different styles. Low-context cultures prefer explicit, direct communication while high-context cultures rely more on relationships and implicit understanding.",
        wrongExplanations: {
            0: "Written-only communication doesn't address the different communication preferences of various cultures.",
            2: "Requiring cultural adaptation one way shows lack of cultural intelligence and inclusivity.",
            3: "Acknowledging and discussing cultural differences actually prevents conflict and builds understanding."
        }
    },
    {
        id: "P013",
        domain: "People",
        topic: "Negotiation",
        difficulty: "Medium",
        question: "During a negotiation with a vendor, what approach leads to the BEST long-term relationship?",
        options: [
            "A) Win-lose: Get the best deal regardless of vendor concerns",
            "B) Lose-win: Give in to vendor demands to maintain relationship",
            "C) Win-win: Seek mutually beneficial solutions",
            "D) Lose-lose: Compromise so neither party is satisfied"
        ],
        correct: 2,
        explanation: "Win-win negotiations create mutually beneficial outcomes that support long-term partnerships. Both parties feel valued and are motivated to uphold agreements.",
        wrongExplanations: {
            0: "Win-lose may get short-term gains but damages the relationship and vendor motivation.",
            1: "Lose-win undermines your project's needs and may not even gain respect from the vendor.",
            3: "Lose-lose creates dissatisfaction on both sides and is unsustainable."
        }
    },
    {
        id: "P014",
        domain: "People",
        topic: "Empowerment",
        difficulty: "Easy",
        question: "What does it mean to empower a project team?",
        options: [
            "A) Give them complete authority with no guidance",
            "B) Provide authority, resources, and accountability to make decisions",
            "C) Allow them to work without deadlines",
            "D) Remove all project constraints"
        ],
        correct: 1,
        explanation: "Empowerment means giving team members the authority to make decisions, providing necessary resources, and holding them accountable for outcomes within appropriate boundaries.",
        wrongExplanations: {
            0: "Empowerment includes guidance and support, not complete autonomy without context.",
            2: "Empowerment doesn't eliminate accountability or deadlines.",
            3: "Constraints are part of project reality; empowerment means working effectively within them."
        }
    },
    {
        id: "P015",
        domain: "People",
        topic: "Performance Management",
        difficulty: "Medium",
        question: "A team member's performance has declined significantly. What should the project manager do FIRST?",
        options: [
            "A) Report the issue to the team member's functional manager",
            "B) Remove them from critical tasks",
            "C) Have a private conversation to understand the root cause",
            "D) Document the performance issues for HR"
        ],
        correct: 2,
        explanation: "The first step is to have a private, supportive conversation to understand what's affecting performance. There may be personal issues, unclear expectations, or obstacles the PM can help remove.",
        wrongExplanations: {
            0: "Escalation should occur after attempting to address the issue directly.",
            1: "Removing tasks doesn't address the root cause and may demotivate further.",
            3: "Documentation is important but should come after attempting to understand and resolve the issue."
        }
    },
    // Additional People Domain questions (P016-P042 abbreviated for space)
    {
        id: "P016",
        domain: "People",
        topic: "Active Listening",
        difficulty: "Easy",
        question: "Which behavior demonstrates active listening?",
        options: [
            "A) Interrupting to share your own experiences",
            "B) Paraphrasing to confirm understanding",
            "C) Planning your response while the other person talks",
            "D) Checking email during the conversation"
        ],
        correct: 1,
        explanation: "Paraphrasing and confirming understanding demonstrates active listening by showing engagement and ensuring accurate comprehension.",
        wrongExplanations: {
            0: "Interrupting prevents full understanding of the speaker's message.",
            2: "Planning your response diverts attention from truly listening.",
            3: "Multi-tasking signals disinterest and disrespect."
        }
    },
    {
        id: "P017",
        domain: "People",
        topic: "Diversity and Inclusion",
        difficulty: "Medium",
        question: "How does diversity benefit project teams?",
        options: [
            "A) It fulfills organizational quotas",
            "B) It brings varied perspectives that enhance problem-solving and innovation",
            "C) It makes team management more challenging",
            "D) It has no measurable impact on project outcomes"
        ],
        correct: 1,
        explanation: "Diverse teams bring different perspectives, experiences, and approaches, leading to more creative solutions and better decision-making.",
        wrongExplanations: {
            0: "While compliance may be a factor, the true value is in enhanced team capability.",
            2: "Diversity may require more sophisticated management but provides significant benefits.",
            3: "Research consistently shows diverse teams outperform homogeneous ones."
        }
    },
    {
        id: "P018",
        domain: "People",
        topic: "Delegation",
        difficulty: "Medium",
        question: "What is the MOST important consideration when delegating tasks?",
        options: [
            "A) Giving away tasks you don't want to do",
            "B) Matching task requirements with team member capabilities and development goals",
            "C) Ensuring you maintain control over all decisions",
            "D) Delegating only to senior team members"
        ],
        correct: 1,
        explanation: "Effective delegation considers both current capability and growth opportunities, matching tasks to develop skills while ensuring success.",
        wrongExplanations: {
            0: "Delegation should be strategic, not just offloading undesirable work.",
            2: "Delegation requires trusting team members to make decisions within their authority.",
            3: "All team members can benefit from delegation appropriate to their level."
        }
    },

    // PROCESS DOMAIN (50 questions)
    {
        id: "PR001",
        domain: "Process",
        topic: "Integration Management",
        difficulty: "Medium",
        question: "During project execution, a team member suggests a change that could improve project outcomes but would require additional budget. What should the project manager do?",
        options: [
            "A) Implement the change immediately since it will improve outcomes",
            "B) Submit the change through the integrated change control process",
            "C) Reject the change to avoid budget overruns",
            "D) Ask the team member to implement it without formal approval"
        ],
        correct: 1,
        explanation: "All changes must go through the integrated change control process, which evaluates impacts across all project areas (scope, time, cost, quality, risk, etc.) and requires proper authorization.",
        wrongExplanations: {
            0: "Implementing changes without proper evaluation and approval can lead to unintended consequences.",
            2: "Rejecting without evaluation misses potential value and discourages team input.",
            3: "Bypassing formal processes violates project governance and creates risks."
        }
    },
    {
        id: "PR002",
        domain: "Process",
        topic: "Scope Management",
        difficulty: "Easy",
        question: "What is the purpose of a Work Breakdown Structure (WBS)?",
        options: [
            "A) To define team member roles and responsibilities",
            "B) To decompose project deliverables into smaller, manageable components",
            "C) To create the project schedule",
            "D) To estimate project costs"
        ],
        correct: 1,
        explanation: "The WBS hierarchically breaks down the total scope of work into deliverables and work packages, making the project more manageable and easier to estimate and control.",
        wrongExplanations: {
            0: "Roles and responsibilities are defined in the RACI matrix or responsibility assignment matrix.",
            2: "The WBS provides input to scheduling but is not the schedule itself.",
            3: "While the WBS supports cost estimation, its primary purpose is scope decomposition."
        }
    },
    {
        id: "PR003",
        domain: "Process",
        topic: "Schedule Management",
        difficulty: "Hard",
        question: "You identify the critical path as A-C-E-G with a duration of 25 days. Path B-D-F takes 22 days. Activity C is delayed by 4 days. What is the new project duration?",
        options: [
            "A) 25 days",
            "B) 26 days",
            "C) 29 days",
            "D) 22 days"
        ],
        correct: 2,
        explanation: "Since Activity C is on the critical path and is delayed by 4 days, the project duration increases by 4 days: 25 + 4 = 29 days. Delays to critical path activities directly impact project completion.",
        wrongExplanations: {
            0: "This ignores the delay to the critical path activity.",
            1: "This only accounts for 1 day delay, not the full 4 days.",
            3: "This is the duration of the non-critical path, which is not relevant to project completion."
        }
    },
    {
        id: "PR004",
        domain: "Process",
        topic: "Cost Management",
        difficulty: "Medium",
        question: "Given: PV = $100,000, EV = $90,000, AC = $95,000. What is the Cost Performance Index (CPI)?",
        options: [
            "A) 0.90",
            "B) 0.95",
            "C) 1.05",
            "D) 1.11"
        ],
        correct: 1,
        explanation: "CPI = EV / AC = $90,000 / $95,000 = 0.95. This indicates the project is over budget, getting only $0.95 of value for every dollar spent.",
        wrongExplanations: {
            0: "This would be the Schedule Performance Index (SPI = EV/PV).",
            2: "This reverses the formula (AC/EV).",
            3: "This calculation is incorrect for CPI."
        }
    },
    {
        id: "PR005",
        domain: "Process",
        topic: "Quality Management",
        difficulty: "Medium",
        question: "What is the difference between quality assurance and quality control?",
        options: [
            "A) Quality assurance inspects deliverables; quality control improves processes",
            "B) Quality assurance is process-oriented; quality control is product-oriented",
            "C) They are the same thing with different names",
            "D) Quality assurance is for Agile; quality control is for Waterfall"
        ],
        correct: 1,
        explanation: "Quality assurance focuses on improving processes to prevent defects, while quality control inspects deliverables to identify defects. QA is proactive; QC is reactive.",
        wrongExplanations: {
            0: "This reverses the definitions of QA and QC.",
            2: "They are distinct activities with different purposes.",
            3: "Both QA and QC apply to all project methodologies."
        }
    },
    {
        id: "PR006",
        domain: "Process",
        topic: "Risk Management",
        difficulty: "Hard",
        question: "A risk has a 30% probability of occurring and would cost $50,000 if it occurs. What is the Expected Monetary Value (EMV) of this risk?",
        options: [
            "A) $50,000",
            "B) $15,000",
            "C) $35,000",
            "D) -$15,000"
        ],
        correct: 3,
        explanation: "EMV = Probability √ó Impact = 0.30 √ó (-$50,000) = -$15,000. The negative value indicates this is a threat (risk with negative impact).",
        wrongExplanations: {
            0: "This is the full impact, not accounting for probability.",
            1: "This calculates the value but misses that it should be negative (a threat/cost).",
            2: "This incorrectly calculates 70% of $50,000 (the probability it won't occur)."
        }
    },
    {
        id: "PR007",
        domain: "Process",
        topic: "Agile/Scrum",
        difficulty: "Easy",
        question: "In Scrum, what is the recommended duration for a Sprint?",
        options: [
            "A) 1 day",
            "B) 1-4 weeks",
            "C) 3-6 months",
            "D) Whatever the team decides"
        ],
        correct: 1,
        explanation: "Scrum recommends Sprint durations of 1-4 weeks (with 2 weeks being most common). This provides a consistent cadence for planning, review, and adaptation.",
        wrongExplanations: {
            0: "One day is too short to deliver meaningful increments.",
            2: "This is too long and reduces agility and feedback opportunities.",
            3: "While teams have input, Scrum specifies the 1-4 week timeframe."
        }
    },
    {
        id: "PR008",
        domain: "Process",
        topic: "Requirements Management",
        difficulty: "Medium",
        question: "What is the BEST way to ensure requirements are complete and unambiguous?",
        options: [
            "A) Have the project manager write all requirements",
            "B) Use templated requirements without customization",
            "C) Conduct requirements reviews with stakeholders",
            "D) Keep requirements high-level to allow flexibility"
        ],
        correct: 2,
        explanation: "Requirements reviews with stakeholders ensure completeness, accuracy, and shared understanding. Multiple perspectives help identify gaps and ambiguities.",
        wrongExplanations: {
            0: "The PM should facilitate, but requirements should come from stakeholders and be validated by them.",
            1: "Templates provide structure but must be customized to project specifics.",
            3: "High-level requirements often lead to scope creep and misalignment."
        }
    },
    {
        id: "PR009",
        domain: "Process",
        topic: "Change Management",
        difficulty: "Medium",
        question: "A stakeholder requests a change after the project baseline has been established. What should happen FIRST?",
        options: [
            "A) Implement the change immediately",
            "B) Update the project management plan",
            "C) Evaluate the change impact across all project constraints",
            "D) Reject the change to protect the baseline"
        ],
        correct: 2,
        explanation: "The first step in change control is to evaluate the change's impact on scope, schedule, cost, quality, risk, and other project factors before making a decision.",
        wrongExplanations: {
            0: "Changes should never be implemented without proper evaluation and approval.",
            1: "The plan is updated only after the change is approved.",
            3: "Not all changes should be rejected; they should be evaluated on their merits."
        }
    },
    {
        id: "PR010",
        domain: "Process",
        topic: "Procurement Management",
        difficulty: "Hard",
        question: "Which contract type places the MOST risk on the buyer?",
        options: [
            "A) Firm Fixed Price (FFP)",
            "B) Cost Plus Fixed Fee (CPFF)",
            "C) Time and Materials (T&M)",
            "D) Fixed Price Incentive Fee (FPIF)"
        ],
        correct: 1,
        explanation: "Cost Plus Fixed Fee (CPFF) places the most risk on the buyer because the buyer pays all costs plus a fee, regardless of cost overruns. The seller has little incentive to control costs.",
        wrongExplanations: {
            0: "FFP places the most risk on the seller, as they must deliver for a fixed price.",
            2: "T&M has shared risk but generally less buyer risk than CPFF.",
            3: "FPIF has shared risk with incentives for cost control."
        }
    },
    {
        id: "PR011",
        domain: "Process",
        topic: "Earned Value Management",
        difficulty: "Hard",
        question: "Project data: BAC = $200,000, EV = $80,000, AC = $100,000. What is the Estimate at Completion (EAC) assuming current performance continues?",
        options: [
            "A) $200,000",
            "B) $220,000",
            "C) $250,000",
            "D) $280,000"
        ],
        correct: 2,
        explanation: "EAC = BAC / CPI. First calculate CPI = EV/AC = 80,000/100,000 = 0.8. Then EAC = 200,000 / 0.8 = $250,000. This assumes current cost performance continues.",
        wrongExplanations: {
            0: "This is the original budget (BAC), not accounting for poor performance.",
            1: "This calculation doesn't properly apply the CPI.",
            3: "This overcalculates the projected overrun."
        }
    },
    {
        id: "PR012",
        domain: "Process",
        topic: "Kanban",
        difficulty: "Easy",
        question: "What is the primary purpose of Work in Progress (WIP) limits in Kanban?",
        options: [
            "A) To restrict team productivity",
            "B) To identify and resolve bottlenecks in the workflow",
            "C) To prevent team members from being busy",
            "D) To increase multitasking"
        ],
        correct: 1,
        explanation: "WIP limits prevent overloading the system and make bottlenecks visible. They encourage flow completion rather than starting more work, improving overall throughput.",
        wrongExplanations: {
            0: "WIP limits actually improve productivity by reducing context switching and increasing focus.",
            2: "The goal is to optimize flow, not to prevent work.",
            3: "WIP limits reduce multitasking to improve focus and quality."
        }
    },
    {
        id: "PR013",
        domain: "Process",
        topic: "Schedule Compression",
        difficulty: "Medium",
        question: "Which schedule compression technique typically increases project cost?",
        options: [
            "A) Fast tracking",
            "B) Crashing",
            "C) Both equally",
            "D) Neither affects cost"
        ],
        correct: 1,
        explanation: "Crashing involves adding resources to shorten the schedule, which typically increases costs. Fast tracking overlaps activities that were sequential, which may increase risk but not necessarily cost.",
        wrongExplanations: {
            0: "Fast tracking primarily increases risk rather than cost.",
            2: "Crashing specifically involves cost increases; fast tracking primarily adds risk.",
            3: "Crashing inherently increases cost through additional resources."
        }
    },
    {
        id: "PR014",
        domain: "Process",
        topic: "Risk Response Strategies",
        difficulty: "Medium",
        question: "The project team purchases insurance for potential damage to equipment. This is an example of which risk response strategy?",
        options: [
            "A) Accept",
            "B) Avoid",
            "C) Transfer",
            "D) Mitigate"
        ],
        correct: 2,
        explanation: "Transfer shifts the risk impact to a third party (the insurance company). The risk still exists but the financial impact is borne by another party.",
        wrongExplanations: {
            0: "Accept means living with the risk without taking action.",
            1: "Avoid eliminates the risk entirely by changing the project plan.",
            3: "Mitigate reduces the probability or impact but doesn't transfer it."
        }
    },
    {
        id: "PR015",
        domain: "Process",
        topic: "Product Backlog",
        difficulty: "Easy",
        question: "Who is responsible for prioritizing the Product Backlog in Scrum?",
        options: [
            "A) Scrum Master",
            "B) Product Owner",
            "C) Development Team",
            "D) Project Manager"
        ],
        correct: 1,
        explanation: "The Product Owner is responsible for maximizing product value and managing the Product Backlog, including prioritization based on business value.",
        wrongExplanations: {
            0: "The Scrum Master facilitates the process but doesn't prioritize.",
            2: "The Development Team estimates and delivers but doesn't prioritize business value.",
            3: "There is no Project Manager role in Scrum."
        }
    },

    // BUSINESS ENVIRONMENT DOMAIN (8 questions)
    {
        id: "BE001",
        domain: "Business Environment",
        topic: "Benefits Realization",
        difficulty: "Medium",
        question: "When should benefits realization be measured for a project?",
        options: [
            "A) Only at project completion",
            "B) Only during project planning",
            "C) Throughout the project lifecycle and after project closure",
            "D) Benefits measurement is not the project manager's responsibility"
        ],
        correct: 2,
        explanation: "Benefits should be identified during planning, tracked during execution, and measured after completion. Many benefits are realized only after the project closes and the product is in use.",
        wrongExplanations: {
            0: "Some benefits can be realized during the project, and many continue after closure.",
            1: "Planning identifies expected benefits, but measurement must occur during and after the project.",
            3: "While others may own benefit realization, the PM plays a key role in enabling and tracking benefits."
        }
    },
    {
        id: "BE002",
        domain: "Business Environment",
        topic: "Business Value",
        difficulty: "Easy",
        question: "What is business value in the context of project management?",
        options: [
            "A) The monetary profit generated by the project",
            "B) The net quantifiable benefit derived from a business endeavor",
            "C) The cost savings achieved by the project",
            "D) The project's return on investment only"
        ],
        correct: 1,
        explanation: "Business value encompasses all benefits - tangible and intangible, financial and non-financial - that the project delivers to stakeholders and the organization.",
        wrongExplanations: {
            0: "Business value includes but is not limited to monetary profit.",
            2: "Cost savings are one component of value but not the complete definition.",
            3: "ROI is one measure of value, but business value is broader and may include intangibles."
        }
    },
    {
        id: "BE003",
        domain: "Business Environment",
        topic: "Compliance",
        difficulty: "Medium",
        question: "A project must comply with new government regulations that were enacted mid-project. What should the project manager do?",
        options: [
            "A) Continue with the original plan and address compliance later",
            "B) Evaluate the impact and submit a change request to update the project",
            "C) Ignore the regulations if they slow down the project",
            "D) Immediately halt all project work"
        ],
        correct: 1,
        explanation: "Compliance requirements must be addressed through the change management process. The PM should evaluate impacts and work with stakeholders to integrate necessary changes.",
        wrongExplanations: {
            0: "Compliance issues cannot be deferred as they may invalidate project deliverables.",
            2: "Ignoring compliance requirements creates legal and business risks.",
            3: "Halting work is premature; assessment and planning should occur first."
        }
    },
    {
        id: "BE004",
        domain: "Business Environment",
        topic: "Organizational Strategy",
        difficulty: "Hard",
        question: "During project initiation, the project manager discovers that the project objectives don't clearly align with the organization's strategic goals. What should they do?",
        options: [
            "A) Proceed with the project as approved",
            "B) Raise concerns with the project sponsor and recommend alignment with strategy",
            "C) Modify the project objectives without approval",
            "D) Decline to manage the project"
        ],
        correct: 1,
        explanation: "Projects should support organizational strategy. The PM should raise the misalignment with the sponsor to ensure the project delivers strategic value or to modify objectives accordingly.",
        wrongExplanations: {
            0: "Proceeding with misaligned projects wastes resources and may not deliver value.",
            2: "Objectives cannot be changed unilaterally; sponsor approval is required.",
            3: "Declining is premature; first attempt to resolve the alignment issue."
        }
    },
    {
        id: "BE005",
        domain: "Business Environment",
        topic: "Portfolio Management",
        difficulty: "Medium",
        question: "What is the primary purpose of portfolio management?",
        options: [
            "A) To manage individual project schedules",
            "B) To optimize resource allocation across projects aligned with strategy",
            "C) To reduce project costs",
            "D) To eliminate project risks"
        ],
        correct: 1,
        explanation: "Portfolio management selects and prioritizes projects to optimize resource investment in initiatives that best support organizational strategy and objectives.",
        wrongExplanations: {
            0: "Individual project management handles schedules; portfolio management focuses on strategy alignment.",
            2: "While cost optimization may result, the primary purpose is strategic value delivery.",
            3: "Risk elimination is impossible and not the purpose of portfolio management."
        }
    },
    {
        id: "BE006",
        domain: "Business Environment",
        topic: "Governance",
        difficulty: "Easy",
        question: "What is the role of a project steering committee?",
        options: [
            "A) To manage day-to-day project activities",
            "B) To provide strategic guidance and make key decisions",
            "C) To execute project tasks",
            "D) To create the project schedule"
        ],
        correct: 1,
        explanation: "A steering committee provides governance through strategic guidance, decision-making on major issues, and oversight to ensure project alignment with business objectives.",
        wrongExplanations: {
            0: "Day-to-day management is the project manager's responsibility.",
            2: "The project team executes tasks; the steering committee provides oversight.",
            3: "Scheduling is a project management activity, not a governance function."
        }
    },
    {
        id: "BE007",
        domain: "Business Environment",
        topic: "Business Case",
        difficulty: "Medium",
        question: "Which of the following is typically NOT included in a business case?",
        options: [
            "A) Expected benefits and costs",
            "B) Risk assessment",
            "C) Detailed project schedule",
            "D) Alignment with organizational strategy"
        ],
        correct: 2,
        explanation: "A business case justifies the project investment with high-level information. A detailed schedule is created later during project planning, not in the business case.",
        wrongExplanations: {
            0: "Benefits and costs are fundamental to justifying the investment.",
            1: "Major risks should be identified to inform the go/no-go decision.",
            3: "Strategic alignment is essential to justify why the project should be undertaken."
        }
    },
    {
        id: "BE008",
        domain: "Business Environment",
        topic: "Organizational Change Management",
        difficulty: "Hard",
        question: "A project will significantly change how employees perform their jobs. What should the project manager prioritize to ensure adoption?",
        options: [
            "A) Technical implementation only",
            "B) Comprehensive change management including communication, training, and support",
            "C) Executive mandate requiring compliance",
            "D) Rapid deployment to prevent resistance"
        ],
        correct: 1,
        explanation: "Successful adoption requires addressing the people side of change through communication, training, stakeholder engagement, and ongoing support. Technical implementation alone is insufficient.",
        wrongExplanations: {
            0: "Technical implementation without change management typically leads to resistance and poor adoption.",
            2: "Mandates without support create compliance without true adoption or optimal usage.",
            3: "Rapid deployment without change management increases resistance and failure risk."
        }
    }
];

        // Study Material Data
        const studyMaterial = [
            {
                domain: "People",
                topics: [
                    {
                        title: "Leadership Styles & Approaches",
                        content: `
                            <p><strong>Servant Leadership:</strong> Focus on serving the team by removing impediments and enabling success.</p>
                            <p><strong>Transformational Leadership:</strong> Inspire team members to achieve extraordinary outcomes.</p>
                            <p><strong>Transactional Leadership:</strong> Focus on supervision, organization, and performance.</p>
                            <p><strong>Situational Leadership:</strong> Adapt leadership style based on team maturity and situation.</p>
                        `
                    },
                    {
                        title: "Team Development - Tuckman Model",
                        content: `
                            <p><strong>Forming:</strong> Team members meet and learn about the project.</p>
                            <p><strong>Storming:</strong> Conflicts arise as team members assert their ideas.</p>
                            <p><strong>Norming:</strong> Team establishes working agreements and processes.</p>
                            <p><strong>Performing:</strong> Team works effectively and cohesively toward goals.</p>
                            <p><strong>Adjourning:</strong> Team completes work and transitions out of the project.</p>
                        `
                    },
                    {
                        title: "Conflict Resolution Techniques",
                        content: `
                            <p><strong>Collaborate/Problem Solve:</strong> Win-win approach addressing concerns of all parties.</p>
                            <p><strong>Compromise:</strong> Both parties give up something to reach agreement.</p>
                            <p><strong>Smooth/Accommodate:</strong> Emphasize areas of agreement.</p>
                            <p><strong>Force/Direct:</strong> Push one viewpoint at expense of others.</p>
                            <p><strong>Withdraw/Avoid:</strong> Postpone issue resolution.</p>
                        `
                    },
                    {
                        title: "Motivation Theories",
                        content: `
                            <p><strong>Maslow's Hierarchy:</strong> Physiological ‚Üí Safety ‚Üí Social ‚Üí Esteem ‚Üí Self-Actualization</p>
                            <p><strong>Herzberg's Two-Factor Theory:</strong></p>
                            <ul>
                                <li>Hygiene Factors (prevent dissatisfaction): Salary, working conditions, security</li>
                                <li>Motivators (drive satisfaction): Achievement, recognition, responsibility, growth</li>
                            </ul>
                            <p><strong>Theory X and Y:</strong> X assumes people dislike work; Y assumes people find work natural and seek responsibility.</p>
                        `
                    }
                ]
            },
            {
                domain: "Process",
                topics: [
                    {
                        title: "Integration Management",
                        content: `
                            <p><strong>Key Processes:</strong></p>
                            <ul>
                                <li>Develop Project Charter - Formally authorize project</li>
                                <li>Develop Project Management Plan - Define how project will be executed</li>
                                <li>Direct and Manage Project Work - Execute the plan</li>
                                <li>Manage Project Knowledge - Share and capture lessons learned</li>
                                <li>Monitor and Control Project Work - Track performance</li>
                                <li>Perform Integrated Change Control - Review and approve changes</li>
                                <li>Close Project or Phase - Finalize all activities</li>
                            </ul>
                        `
                    },
                    {
                        title: "Earned Value Management (EVM)",
                        content: `
                            <p><strong>Key Terms:</strong></p>
                            <ul>
                                <li><strong>PV (Planned Value):</strong> Budgeted cost of work scheduled</li>
                                <li><strong>EV (Earned Value):</strong> Budgeted cost of work performed</li>
                                <li><strong>AC (Actual Cost):</strong> Actual cost of work performed</li>
                                <li><strong>BAC (Budget at Completion):</strong> Total planned budget</li>
                            </ul>
                            <p><strong>Key Formulas:</strong></p>
                            <ul>
                                <li><strong>SV (Schedule Variance):</strong> EV - PV (negative = behind schedule)</li>
                                <li><strong>CV (Cost Variance):</strong> EV - AC (negative = over budget)</li>
                                <li><strong>SPI (Schedule Performance Index):</strong> EV / PV (< 1 = behind)</li>
                                <li><strong>CPI (Cost Performance Index):</strong> EV / AC (< 1 = over budget)</li>
                                <li><strong>EAC (Estimate at Completion):</strong> BAC / CPI (typical formula)</li>
                            </ul>
                        `
                    },
                    {
                        title: "Agile/Scrum Framework",
                        content: `
                            <p><strong>Scrum Roles:</strong></p>
                            <ul>
                                <li><strong>Product Owner:</strong> Maximizes product value, manages Product Backlog</li>
                                <li><strong>Scrum Master:</strong> Facilitates process, removes impediments</li>
                                <li><strong>Development Team:</strong> Self-organizing, cross-functional team that delivers increments</li>
                            </ul>
                            <p><strong>Scrum Events:</strong></p>
                            <ul>
                                <li><strong>Sprint:</strong> Time-boxed iteration (1-4 weeks)</li>
                                <li><strong>Sprint Planning:</strong> Define Sprint Goal and plan work</li>
                                <li><strong>Daily Scrum:</strong> 15-minute synchronization meeting</li>
                                <li><strong>Sprint Review:</strong> Demonstrate increment to stakeholders</li>
                                <li><strong>Sprint Retrospective:</strong> Team reflects on process improvement</li>
                            </ul>
                        `
                    },
                    {
                        title: "Risk Management",
                        content: `
                            <p><strong>Risk Response Strategies:</strong></p>
                            <p><em>For Threats (Negative Risks):</em></p>
                            <ul>
                                <li><strong>Avoid:</strong> Eliminate the threat by changing the plan</li>
                                <li><strong>Transfer:</strong> Shift impact to third party (insurance, contract)</li>
                                <li><strong>Mitigate:</strong> Reduce probability or impact</li>
                                <li><strong>Accept:</strong> Acknowledge risk without active response</li>
                            </ul>
                            <p><em>For Opportunities (Positive Risks):</em></p>
                            <ul>
                                <li><strong>Exploit:</strong> Ensure opportunity happens</li>
                                <li><strong>Share:</strong> Partner with third party to share benefit</li>
                                <li><strong>Enhance:</strong> Increase probability or impact</li>
                                <li><strong>Accept:</strong> Take advantage if it occurs</li>
                            </ul>
                        `
                    },
                    {
                        title: "Contract Types",
                        content: `
                            <p><strong>Fixed Price (FP):</strong> Seller agrees to deliver for fixed price.</p>
                            <ul>
                                <li>Risk primarily on seller</li>
                                <li>Requires well-defined scope</li>
                            </ul>
                            <p><strong>Cost Reimbursable (CR):</strong> Buyer pays seller's costs plus fee.</p>
                            <ul>
                                <li>Risk primarily on buyer</li>
                                <li>Used when scope is uncertain</li>
                                <li>Types: CPFF (Fixed Fee), CPIF (Incentive Fee), CPAF (Award Fee)</li>
                            </ul>
                            <p><strong>Time & Materials (T&M):</strong> Hybrid approach, priced by time and materials.</p>
                            <ul>
                                <li>Balanced risk</li>
                                <li>Flexible for changing scope</li>
                            </ul>
                        `
                    }
                ]
            },
            {
                domain: "Business Environment",
                topics: [
                    {
                        title: "Benefits Realization Management",
                        content: `
                            <p>Benefits realization ensures that projects deliver the intended business value.</p>
                            <p><strong>Key Concepts:</strong></p>
                            <ul>
                                <li><strong>Benefits Identification:</strong> Define expected business benefits during planning</li>
                                <li><strong>Benefits Analysis:</strong> Determine how to measure and track benefits</li>
                                <li><strong>Benefits Delivery:</strong> Ensure project outputs enable benefits</li>
                                <li><strong>Benefits Sustainment:</strong> Maintain benefits after project closure</li>
                            </ul>
                            <p>Many benefits are realized after project completion when products/services are operational.</p>
                        `
                    },
                    {
                        title: "Organizational Strategy Alignment",
                        content: `
                            <p>Projects should align with and support organizational strategic objectives.</p>
                            <p><strong>Portfolio Management:</strong> Selects and prioritizes projects that deliver maximum strategic value.</p>
                            <p><strong>Program Management:</strong> Coordinates related projects to achieve strategic benefits.</p>
                            <p><strong>Project Management:</strong> Delivers specific objectives that support strategy.</p>
                            <p>Project managers should understand how their project contributes to organizational goals.</p>
                        `
                    },
                    {
                        title: "Compliance & Governance",
                        content: `
                            <p><strong>Compliance:</strong> Adhering to laws, regulations, standards, and organizational policies.</p>
                            <p><strong>Governance:</strong> Framework that guides project decision-making and accountability.</p>
                            <p><strong>Key Elements:</strong></p>
                            <ul>
                                <li>Steering committees provide oversight</li>
                                <li>Stage gates control progression</li>
                                <li>Policies define acceptable practices</li>
                                <li>Audits ensure compliance</li>
                            </ul>
                            <p>Project managers must understand and implement governance requirements.</p>
                        `
                    }
                ]
            }
        ];

        // Application State
        let userData = {
            attempts: [], // {questionId, timestamp, correct, confidence, needsReview, elaboration, nextReviewDate}
            studyProgress: {},
            settings: {
                questionsPerSession: 20,
                timerEnabled: false,
                soundEnabled: true,
                darkMode: false
            },
            lastStudyDate: null,
            studyStreak: 0
        };

        let currentSession = {
            questions: [],
            currentIndex: 0,
            startTime: null,
            questionStartTime: null,
            selectedAnswer: null,
            answered: false
        };

        // Initialize Application
        function init() {
            loadUserData();
            updateDashboard();
            renderStudyMaterial();
            updateReviewBadge();
            updateStreakDisplay();
            syncDarkModeToggles();
        }

        // Data Management (using in-memory storage)
        function loadUserData() {
            // Data persists only during the session (no localStorage in sandboxed environment)
            // Check and update streak
            updateStreak();
        }

        function saveUserData() {
            // Data is maintained in memory during the session
            // In a production environment, this would sync to a backend
        }

        function updateStreak() {
            const today = new Date().toDateString();
            if (userData.lastStudyDate !== today) {
                const lastDate = userData.lastStudyDate ? new Date(userData.lastStudyDate) : null;
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (lastDate && lastDate.toDateString() === yesterday.toDateString()) {
                    // Consecutive day
                    userData.studyStreak++;
                } else if (!lastDate || lastDate.toDateString() !== today) {
                    // Streak broken or first time
                    userData.studyStreak = 1;
                }
                userData.lastStudyDate = today;
                saveUserData();
            }
        }

        function updateStreakDisplay() {
            const streakEl = document.getElementById('streakDisplay');
            const days = userData.studyStreak || 0;
            streakEl.textContent = `üî• ${days} day${days !== 1 ? 's' : ''} streak`;
        }

        // Tab Management
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'analytics') {
                renderAnalytics();
            } else if (tabName === 'review') {
                renderReviewContent();
            }
        }

        // Dashboard Functions
        function updateDashboard() {
            const stats = calculateStats();
            
            // Update domain progress
            updateDomainProgress('people', stats.people);
            updateDomainProgress('process', stats.process);
            updateDomainProgress('business', stats.business);

            // Update stat cards
            document.getElementById('totalAttempted').textContent = stats.totalAttempts;
            document.getElementById('accuracyRate').textContent = stats.overallAccuracy + '%';
            document.getElementById('reviewDue').textContent = stats.reviewsDue;
        }

        function updateDomainProgress(domain, accuracy) {
            const progressBar = document.getElementById(domain + 'Progress');
            const scoreLabel = document.getElementById(domain + 'Score');
            
            progressBar.style.width = accuracy + '%';
            progressBar.textContent = accuracy + '%';
            scoreLabel.textContent = accuracy + '%';
        }

        function calculateStats() {
            const attempts = userData.attempts || [];
            const now = Date.now();
            
            // Get unique questions attempted per domain
            const peopleAttempts = attempts.filter(a => {
                const q = questionBank.find(q => q.id === a.questionId);
                return q && q.domain === 'People';
            });
            const processAttempts = attempts.filter(a => {
                const q = questionBank.find(q => q.id === a.questionId);
                return q && q.domain === 'Process';
            });
            const businessAttempts = attempts.filter(a => {
                const q = questionBank.find(q => q.id === a.questionId);
                return q && q.domain === 'Business Environment';
            });

            const peopleCorrect = peopleAttempts.filter(a => a.correct).length;
            const processCorrect = processAttempts.filter(a => a.correct).length;
            const businessCorrect = businessAttempts.filter(a => a.correct).length;

            const peopleAccuracy = peopleAttempts.length > 0 ? Math.round((peopleCorrect / peopleAttempts.length) * 100) : 0;
            const processAccuracy = processAttempts.length > 0 ? Math.round((processCorrect / processAttempts.length) * 100) : 0;
            const businessAccuracy = businessAttempts.length > 0 ? Math.round((businessCorrect / businessAttempts.length) * 100) : 0;

            const totalCorrect = attempts.filter(a => a.correct).length;
            const overallAccuracy = attempts.length > 0 ? Math.round((totalCorrect / attempts.length) * 100) : 0;

            const reviewsDue = attempts.filter(a => a.nextReviewDate && a.nextReviewDate <= now).length;

            return {
                people: peopleAccuracy,
                process: processAccuracy,
                business: businessAccuracy,
                totalAttempts: attempts.length,
                overallAccuracy,
                reviewsDue
            };
        }

        // Study Material Functions
        function renderStudyMaterial() {
            const container = document.getElementById('studyContent');
            container.innerHTML = '';

            studyMaterial.forEach(domainMaterial => {
                const domainCard = document.createElement('div');
                domainCard.className = 'card';
                domainCard.dataset.domain = domainMaterial.domain;
                
                const domainTitle = document.createElement('h3');
                domainTitle.textContent = domainMaterial.domain + ' Domain';
                domainCard.appendChild(domainTitle);

                domainMaterial.topics.forEach((topic, index) => {
                    const topicCard = document.createElement('div');
                    topicCard.className = 'topic-card';
                    
                    const topicHeader = document.createElement('div');
                    topicHeader.className = 'topic-header';
                    topicHeader.innerHTML = `<strong>${topic.title}</strong> <span>‚ñº</span>`;
                    topicHeader.onclick = () => toggleTopic(topicCard);
                    
                    const topicContent = document.createElement('div');
                    topicContent.className = 'topic-content';
                    topicContent.innerHTML = topic.content;
                    
                    topicCard.appendChild(topicHeader);
                    topicCard.appendChild(topicContent);
                    domainCard.appendChild(topicCard);
                });

                container.appendChild(domainCard);
            });
        }

        function toggleTopic(topicCard) {
            const content = topicCard.querySelector('.topic-content');
            content.classList.toggle('expanded');
        }

        function filterStudyMaterial() {
            const filter = document.getElementById('studyDomainFilter').value;
            const cards = document.querySelectorAll('#studyContent .card');
            
            cards.forEach(card => {
                if (filter === 'all' || card.dataset.domain === filter) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Practice Session Functions
        function startPracticeSession() {
            const numQuestions = parseInt(document.getElementById('questionsPerSession').value);
            const domain = document.getElementById('practiceDomain').value;
            const difficulty = document.getElementById('practiceDifficulty').value;
            
            let availableQuestions = [...questionBank];
            
            // Filter by domain
            if (domain !== 'all') {
                availableQuestions = availableQuestions.filter(q => q.domain === domain);
            }
            
            // Filter by difficulty
            if (difficulty !== 'all') {
                availableQuestions = availableQuestions.filter(q => q.difficulty === difficulty);
            }

            // Interleave questions (shuffle)
            availableQuestions = shuffleArray(availableQuestions);
            
            // Select requested number
            currentSession.questions = availableQuestions.slice(0, Math.min(numQuestions, availableQuestions.length));
            currentSession.currentIndex = 0;
            currentSession.startTime = Date.now();
            
            document.getElementById('practiceSession').style.display = 'block';
            displayQuestion();
            
            if (document.getElementById('timerToggle').checked) {
                startTimer();
            }
        }

        function displayQuestion() {
            if (currentSession.currentIndex >= currentSession.questions.length) {
                endPracticeSession();
                return;
            }

            const question = currentSession.questions[currentSession.currentIndex];
            currentSession.questionStartTime = Date.now();
            currentSession.selectedAnswer = null;
            currentSession.answered = false;

            document.getElementById('questionProgress').textContent = 
                `Question ${currentSession.currentIndex + 1} of ${currentSession.questions.length}`;
            document.getElementById('questionDomain').textContent = question.domain;
            document.getElementById('questionDomain').className = 'badge badge-' + question.domain.toLowerCase().replace(' ', '-');
            document.getElementById('questionDifficulty').textContent = question.difficulty;
            document.getElementById('questionDifficulty').className = 'badge badge-' + question.difficulty.toLowerCase();
            document.getElementById('questionText').textContent = question.question;

            const optionsContainer = document.getElementById('questionOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('feedbackSection').style.display = 'none';
            document.getElementById('submitBtn').style.display = 'inline-flex';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('skipBtn').style.display = 'inline-flex';
            document.getElementById('elaborationNotes').value = '';
        }

        function selectOption(index) {
            if (currentSession.answered) return;
            
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected'));
            options[index].classList.add('selected');
            currentSession.selectedAnswer = index;
        }

        function submitAnswer() {
            if (currentSession.selectedAnswer === null) {
                alert('Please select an answer before submitting.');
                return;
            }

            currentSession.answered = true;
            const question = currentSession.questions[currentSession.currentIndex];
            const isCorrect = currentSession.selectedAnswer === question.correct;

            // Visual feedback
            const options = document.querySelectorAll('.option');
            options[currentSession.selectedAnswer].classList.add(isCorrect ? 'correct' : 'incorrect');
            if (!isCorrect) {
                options[question.correct].classList.add('correct');
            }

            // Show explanation
            let explanationHTML = `<strong>${isCorrect ? '‚úì Correct!' : '‚úó Incorrect'}</strong><br><br>`;
            explanationHTML += `<strong>Explanation:</strong> ${question.explanation}<br><br>`;
            
            if (!isCorrect && question.wrongExplanations) {
                const wrongIdx = currentSession.selectedAnswer;
                if (question.wrongExplanations[wrongIdx]) {
                    explanationHTML += `<strong>Why your answer is incorrect:</strong> ${question.wrongExplanations[wrongIdx]}`;
                }
            }
            
            document.getElementById('explanation').innerHTML = explanationHTML;
            document.getElementById('feedbackSection').style.display = 'block';
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('skipBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-flex';

            // Update streak
            updateStreak();
            updateStreakDisplay();
        }

        function rateConfidence(level) {
            const question = currentSession.questions[currentSession.currentIndex];
            const isCorrect = currentSession.selectedAnswer === question.correct;
            const elaboration = document.getElementById('elaborationNotes').value;

            // Calculate next review date based on performance
            let daysUntilReview = 1;
            if (!isCorrect) {
                daysUntilReview = 1;
            } else if (level === 'low') {
                daysUntilReview = 3;
            } else if (level === 'medium') {
                daysUntilReview = 7;
            } else if (level === 'high') {
                // Check if mastered (3+ correct in a row)
                const previousAttempts = userData.attempts.filter(a => a.questionId === question.id);
                const recentCorrect = previousAttempts.slice(-2).every(a => a.correct);
                daysUntilReview = recentCorrect ? 14 : 7;
            }

            const nextReviewDate = Date.now() + (daysUntilReview * 24 * 60 * 60 * 1000);

            // Save attempt
            userData.attempts.push({
                questionId: question.id,
                timestamp: Date.now(),
                correct: isCorrect,
                confidence: level,
                needsReview: level === 'low',
                elaboration: elaboration,
                nextReviewDate: nextReviewDate
            });
            
            saveUserData();
            updateDashboard();
            updateReviewBadge();
            
            // Check for milestones
            checkMilestones();
        }

        function nextQuestion() {
            currentSession.currentIndex++;
            displayQuestion();
        }

        function skipQuestion() {
            nextQuestion();
        }

        function endPracticeSession() {
            const sessionStats = calculateSessionStats();
            alert(`Session Complete!\n\nQuestions: ${sessionStats.total}\nCorrect: ${sessionStats.correct}\nAccuracy: ${sessionStats.accuracy}%`);
            document.getElementById('practiceSession').style.display = 'none';
            updateDashboard();
        }

        function calculateSessionStats() {
        const sessionAttempts = userData.attempts.slice(-currentSession.questions.length);
                    const correct = sessionAttempts.filter(a => a.correct).length;
                    const total = sessionAttempts.length;
            const accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
            return { correct, total, accuracy };
        }

        // Timer Functions
        let timerInterval = null;
        
        function startTimer() {
            const timerDisplay = document.getElementById('timerDisplay');
            timerDisplay.style.display = 'block';
            
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - currentSession.questionStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                timerDisplay.textContent = `‚è±Ô∏è ${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // Review Functions
        function updateReviewBadge() {
            const stats = calculateStats();
            document.getElementById('reviewBadge').textContent = stats.reviewsDue;
        }

        function renderReviewContent() {
            const now = Date.now();
            const dueReviews = userData.attempts.filter(a => a.nextReviewDate && a.nextReviewDate <= now);
            
            const statsDiv = document.getElementById('reviewStats');
            statsDiv.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--warning), #d97706);">
                        <div class="stat-value">${dueReviews.length}</div>
                        <div class="stat-label">Reviews Due Today</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--primary), #3b82f6);">
                        <div class="stat-value">${userData.attempts.length}</div>
                        <div class="stat-label">Total Questions Studied</div>
                    </div>
                </div>
            `;

            if (dueReviews.length === 0) {
                document.getElementById('reviewContent').innerHTML = `
                    <div class="card">
                        <p style="text-align: center; padding: 40px;">üéâ Great job! No reviews due today. Keep up the excellent work!</p>
                    </div>
                `;
            }
        }

        function startReviewSession() {
            const now = Date.now();
            const dueReviews = userData.attempts.filter(a => a.nextReviewDate && a.nextReviewDate <= now);
            
            if (dueReviews.length === 0) {
                alert('No reviews due at this time!');
                return;
            }

            // Get unique question IDs
            const questionIds = [...new Set(dueReviews.map(a => a.questionId))];
            const reviewQuestions = questionBank.filter(q => questionIds.includes(q.id));
            
            currentSession.questions = shuffleArray(reviewQuestions);
            currentSession.currentIndex = 0;
            currentSession.startTime = Date.now();
            
            switchTab('practice');
            document.getElementById('practiceSession').style.display = 'block';
            displayQuestion();
        }

        function showReviewSchedule() {
            const upcoming = userData.attempts
                .filter(a => a.nextReviewDate > Date.now())
                .sort((a, b) => a.nextReviewDate - b.nextReviewDate)
                .slice(0, 10);

            let html = '<div class="card"><h3>Upcoming Reviews</h3>';
            if (upcoming.length === 0) {
                html += '<p>No upcoming reviews scheduled.</p>';
            } else {
                upcoming.forEach(attempt => {
                    const question = questionBank.find(q => q.id === attempt.questionId);
                    const daysUntil = Math.ceil((attempt.nextReviewDate - Date.now()) / (24 * 60 * 60 * 1000));
                    html += `
                        <div class="review-item">
                            <span><strong>${question.domain}:</strong> ${question.topic}</span>
                            <span class="badge">In ${daysUntil} day${daysUntil !== 1 ? 's' : ''}</span>
                        </div>
                    `;
                });
            }
            html += '</div>';
            document.getElementById('reviewContent').innerHTML = html;
        }

        // Analytics Functions
        function renderAnalytics() {
            renderDomainChart();
            renderTrendChart();
            renderDetailedStats();
        }

        function renderDomainChart() {
            const canvas = document.getElementById('domainChart');
            const ctx = canvas.getContext('2d');
            const stats = calculateStats();

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const data = [
                { label: 'People', value: stats.people, color: '#3b82f6' },
                { label: 'Process', value: stats.process, color: '#10b981' },
                { label: 'Business Env', value: stats.business, color: '#f59e0b' }
            ];

            const barHeight = 50;
            const barSpacing = 30;
            const maxWidth = canvas.width - 150;

            data.forEach((item, index) => {
                const y = index * (barHeight + barSpacing) + 20;
                const barWidth = (item.value / 100) * maxWidth;

                // Draw label
                ctx.fillStyle = '#374151';
                ctx.font = '14px Arial';
                ctx.fillText(item.label, 10, y + barHeight / 2 + 5);

                // Draw bar background
                ctx.fillStyle = '#e5e7eb';
                ctx.fillRect(120, y, maxWidth, barHeight);

                // Draw bar
                ctx.fillStyle = item.color;
                ctx.fillRect(120, y, barWidth, barHeight);

                // Draw percentage
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Arial';
                ctx.fillText(item.value + '%', 130, y + barHeight / 2 + 5);
            });
        }

        function renderTrendChart() {
            const canvas = document.getElementById('trendChart');
            const ctx = canvas.getContext('2d');

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Group attempts by day
            const dailyAccuracy = {};
            userData.attempts.forEach(attempt => {
                const date = new Date(attempt.timestamp).toLocaleDateString();
                if (!dailyAccuracy[date]) {
                    dailyAccuracy[date] = { correct: 0, total: 0 };
                }
                dailyAccuracy[date].total++;
                if (attempt.correct) dailyAccuracy[date].correct++;
            });

            const dates = Object.keys(dailyAccuracy).slice(-7);
            if (dates.length === 0) {
                ctx.fillStyle = '#374151';
                ctx.font = '14px Arial';
                ctx.fillText('No data available yet. Start practicing!', 20, canvas.height / 2);
                return;
            }

            const accuracies = dates.map(date => {
                const data = dailyAccuracy[date];
                return Math.round((data.correct / data.total) * 100);
            });

            const padding = 40;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;
            const pointSpacing = chartWidth / (dates.length - 1 || 1);

            // Draw axes
            ctx.strokeStyle = '#d1d5db';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();

            // Draw line
            ctx.strokeStyle = '#2563eb';
            ctx.lineWidth = 3;
            ctx.beginPath();
            accuracies.forEach((accuracy, index) => {
                const x = padding + index * pointSpacing;
                const y = canvas.height - padding - (accuracy / 100 * chartHeight);
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // Draw points
            ctx.fillStyle = '#2563eb';
            accuracies.forEach((accuracy, index) => {
                const x = padding + index * pointSpacing;
                const y = canvas.height - padding - (accuracy / 100 * chartHeight);
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();

                // Draw labels
                ctx.fillStyle = '#374151';
                ctx.font = '12px Arial';
                ctx.fillText(accuracy + '%', x - 15, y - 10);
            });
        }

        function renderDetailedStats() {
            const container = document.getElementById('detailedStats');
            const stats = calculateStats();

            // Find weak and strong areas
            const topicStats = {};
            userData.attempts.forEach(attempt => {
                const question = questionBank.find(q => q.id === attempt.questionId);
                if (question) {
                    const key = `${question.domain} - ${question.topic}`;
                    if (!topicStats[key]) {
                        topicStats[key] = { correct: 0, total: 0 };
                    }
                    topicStats[key].total++;
                    if (attempt.correct) topicStats[key].correct++;
                }
            });

            const topicAccuracies = Object.entries(topicStats).map(([topic, data]) => ({
                topic,
                accuracy: Math.round((data.correct / data.total) * 100),
                attempts: data.total
            })).sort((a, b) => a.accuracy - b.accuracy);

            const weakAreas = topicAccuracies.filter(t => t.accuracy < 70).slice(0, 5);
            const strongAreas = topicAccuracies.filter(t => t.accuracy >= 85).slice(-5);

            let html = '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">';

            // Weak areas
            html += '<div><h4 style="color: var(--danger);">Areas for Improvement</h4>';
            if (weakAreas.length === 0) {
                html += '<p>No weak areas identified. Great job!</p>';
            } else {
                weakAreas.forEach(area => {
                    html += `
                        <div style="padding: 10px; margin: 5px 0; background: rgba(239, 68, 68, 0.1); border-left: 3px solid var(--danger); border-radius: 4px;">
                            <strong>${area.topic}</strong><br>
                            <span style="font-size: 0.9rem;">${area.accuracy}% (${area.attempts} attempts)</span>
                        </div>
                    `;
                });
            }
            html += '</div>';

            // Strong areas
            html += '<div><h4 style="color: var(--success);">Strong Areas</h4>';
            if (strongAreas.length === 0) {
                html += '<p>Keep practicing to build your strengths!</p>';
            } else {
                strongAreas.forEach(area => {
                    html += `
                        <div style="padding: 10px; margin: 5px 0; background: rgba(16, 185, 129, 0.1); border-left: 3px solid var(--success); border-radius: 4px;">
                            <strong>${area.topic}</strong><br>
                            <span style="font-size: 0.9rem;">${area.accuracy}% (${area.attempts} attempts)</span>
                        </div>
                    `;
                });
            }
            html += '</div></div>';

            container.innerHTML = html;
        }

        // Settings Functions
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            userData.settings.darkMode = document.body.classList.contains('dark-mode');
            saveUserData();
            syncDarkModeToggles();
        }

        function syncDarkModeToggles() {
            const isDark = document.body.classList.contains('dark-mode') || userData.settings.darkMode;
            document.getElementById('darkModeToggle').checked = isDark;
            document.getElementById('darkModeToggle2').checked = isDark;
            if (isDark) {
                document.body.classList.add('dark-mode');
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(userData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'pmp-prep-data.json';
            link.click();
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        userData = JSON.parse(event.target.result);
                        saveUserData();
                        updateDashboard();
                        alert('Data imported successfully!');
                    } catch (error) {
                        alert('Error importing data. Please check the file format.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function confirmReset() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                if (confirm('Really sure? All your study data will be lost!')) {
                    userData = {
                        attempts: [],
                        studyProgress: {},
                        settings: { questionsPerSession: 20, timerEnabled: false, soundEnabled: true, darkMode: false },
                        lastStudyDate: null,
                        studyStreak: 0
                    };
                    saveUserData();
                    updateDashboard();
                    updateReviewBadge();
                    updateStreakDisplay();
                    alert('All progress has been reset.');
                }
            }
        }

        // Milestone Functions
        function checkMilestones() {
            const totalAttempts = userData.attempts.length;
            const milestones = [10, 25, 50, 100, 200];
            
            if (milestones.includes(totalAttempts)) {
                showMilestone(totalAttempts);
            }
        }

        function showMilestone(count) {
            const messages = {
                10: 'You\'ve answered your first 10 questions! Keep building momentum!',
                25: 'Quarter century! 25 questions completed. You\'re on your way!',
                50: 'Halfway to 100! Your dedication is paying off!',
                100: 'Century mark! 100 questions mastered. Outstanding progress!',
                200: 'Double century! You\'re becoming a PMP expert!'
            };

            document.getElementById('milestoneTitle').textContent = 'üéâ Milestone Achieved!';
            document.getElementById('milestoneMessage').textContent = messages[count];
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('milestonePopup').style.display = 'block';
        }

        function closeMilestone() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('milestonePopup').style.display = 'none';
        }

        // Utility Functions
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
